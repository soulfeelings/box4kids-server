# üìù API –æ—Ç–∑—ã–≤–æ–≤ –Ω–∞ –Ω–∞–±–æ—Ä—ã –∏–≥—Ä—É—à–µ–∫

## –û–±–∑–æ—Ä

API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –Ω–∞–±–æ—Ä—ã –∏–≥—Ä—É—à–µ–∫. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤ —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º 1-5 –∑–≤–µ–∑–¥ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏.

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### POST /api/toy-boxes/{box_id}/review

–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –∫ –Ω–∞–±–æ—Ä—É

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `box_id` (path) - ID –Ω–∞–±–æ—Ä–∞ –∏–≥—Ä—É—à–µ–∫

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**

```json
{
  "user_id": 1,
  "rating": 5,
  "comment": "–û—Ç–ª–∏—á–Ω—ã–π –Ω–∞–±–æ—Ä! –†–µ–±–µ–Ω–æ–∫ –≤ –≤–æ—Å—Ç–æ—Ä–≥–µ."
}
```

**–ü–æ–ª—è:**

- `user_id` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `rating` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - –†–µ–π—Ç–∏–Ω–≥ –æ—Ç 1 –¥–æ 5
- `comment` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200):**

```json
{
  "message": "–û—Ç–∑—ã–≤ –¥–æ–±–∞–≤–ª–µ–Ω",
  "review": {
    "id": 1,
    "user_id": 1,
    "rating": 5,
    "comment": "–û—Ç–ª–∏—á–Ω—ã–π –Ω–∞–±–æ—Ä! –†–µ–±–µ–Ω–æ–∫ –≤ –≤–æ—Å—Ç–æ—Ä–≥–µ.",
    "created_at": "2024-01-15T10:30:00Z"
  }
}
```

**–û—à–∏–±–∫–∏:**

- `400` - –ù–∞–±–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
- `400` - –ù–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –Ω–∞–±–æ—Ä—É
- `400` - –û—Ç–∑—ã–≤ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä
- `400` - –í—ã —É–∂–µ –æ—Å—Ç–∞–≤–∏–ª–∏ –æ—Ç–∑—ã–≤ –Ω–∞ —ç—Ç–æ—Ç –Ω–∞–±–æ—Ä
- `422` - –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (—Ä–µ–π—Ç–∏–Ω–≥ –Ω–µ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 1-5)

### GET /api/toy-boxes/{box_id}/reviews

–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ—Ç–∑—ã–≤—ã –¥–ª—è –Ω–∞–±–æ—Ä–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `box_id` (path) - ID –Ω–∞–±–æ—Ä–∞ –∏–≥—Ä—É—à–µ–∫

**–û—Ç–≤–µ—Ç (200):**

```json
{
  "reviews": [
    {
      "id": 1,
      "user_id": 1,
      "rating": 5,
      "comment": "–û—Ç–ª–∏—á–Ω—ã–π –Ω–∞–±–æ—Ä!",
      "created_at": "2024-01-15T10:30:00Z"
    },
    {
      "id": 2,
      "user_id": 2,
      "rating": 4,
      "comment": null,
      "created_at": "2024-01-15T11:00:00Z"
    }
  ]
}
```

## –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–û–¥–∏–Ω –æ—Ç–∑—ã–≤ –Ω–∞ –Ω–∞–±–æ—Ä** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –æ—Ç–∑—ã–≤ –Ω–∞ –∫–∞–∂–¥—ã–π –Ω–∞–±–æ—Ä
2. **–¢–æ–ª—å–∫–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞–±–æ—Ä—ã** - –æ—Ç–∑—ã–≤ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–∞–±–æ—Ä—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `DELIVERED`
3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** - –æ—Ç–∑—ã–≤ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ä–æ–¥–∏—Ç–µ–ª—å —Ä–µ–±–µ–Ω–∫–∞, –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –Ω–∞–±–æ—Ä
4. **–†–µ–π—Ç–∏–Ω–≥** - —Å—Ç—Ä–æ–≥–æ –æ—Ç 1 –¥–æ 5 –∑–≤–µ–∑–¥
5. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π** - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–∞–∫—Å–∏–º—É–º 500 —Å–∏–º–≤–æ–ª–æ–≤

### –°—Ç–∞—Ç—É—Å—ã –Ω–∞–±–æ—Ä–æ–≤

- `PLANNED` - –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω
- `ASSEMBLED` - —Å–æ–±—Ä–∞–Ω
- `SHIPPED` - –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
- `DELIVERED` - –¥–æ—Å—Ç–∞–≤–ª–µ–Ω ‚úÖ (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤)
- `RETURNED` - –≤–æ–∑–≤—Ä–∞—â–µ–Ω

## UI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –õ–æ–≥–∏–∫–∞ –∑–≤–µ–∑–¥

```javascript
const ratingTexts = {
  1: "–£–∂–∞—Å–Ω–æ! –ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å?",
  2: "–ü–ª–æ—Ö–æ. –ß—Ç–æ –≤–∞–º –æ—Å–æ–±–µ–Ω–Ω–æ –Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å?",
  3: "–¢–∞–∫ —Å–µ–±–µ. –ß—Ç–æ –Ω–µ —É—Å—Ç—Ä–æ–∏–ª–æ?",
  4: "–•–æ—Ä–æ—à–æ! –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É! –ß—Ç–æ –≤–∞–º –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å?",
  5: "–û—Ç–ª–∏—á–Ω–æ! –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É! –ß—Ç–æ –≤–∞–º –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å?",
};
```

### –ü—Ä–∏–º–µ—Ä React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

```jsx
const ReviewModal = ({ boxId, userId, onClose }) => {
  const [rating, setRating] = useState(0);
  const [comment, setComment] = useState("");

  const handleSubmit = async () => {
    const response = await fetch(`/api/toy-boxes/${boxId}/review`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ user_id: userId, rating, comment }),
    });

    if (response.ok) {
      onClose();
      // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—Ö
    } else {
      const error = await response.json();
      // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
    }
  };

  return (
    <div className="review-modal">
      <h3>–ö–∞–∫ –≤–∞–º –Ω–∞–±–æ—Ä –∏–≥—Ä—É—à–µ–∫?</h3>
      <StarRating rating={rating} onChange={setRating} />
      <p>{ratingTexts[rating]}</p>
      <textarea
        value={comment}
        onChange={(e) => setComment(e.target.value)}
        placeholder="–ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"
        maxLength={500}
      />
      <button onClick={handleSubmit}>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  );
};
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `test_reviews.py`:

```bash
python test_reviews.py
```

–¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç:

- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∞–ª–∏–¥–Ω–æ–≥–æ –æ—Ç–∑—ã–≤–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—é —Ä–µ–π—Ç–∏–Ω–≥–∞ (1-5)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫—É –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ—Ç–∑—ã–≤–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

–ú–æ–¥–µ–ª–∏ —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã –∏ –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:

- `toy_box_reviews` - —Ç–∞–±–ª–∏—Ü–∞ –æ—Ç–∑—ã–≤–æ–≤
- –°–≤—è–∑—å —Å `toy_boxes` –∏ `users` —á–µ—Ä–µ–∑ foreign keys

## –°–æ–±—ã—Ç–∏–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–∑—ã–≤–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ:

```python
# –í –±—É–¥—É—â–µ–º - –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
review_event = ToyBoxReviewedEvent(
    box_id=box_id,
    user_id=user_id,
    rating=rating
)
publisher.publish_event(
    exchange=ExchangeNames.BOX4KIDS_EVENTS,
    routing_key=RoutingKeys.TOYBOX_REVIEWED,
    event_data=review_event.to_dict()
)
```
